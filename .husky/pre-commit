#!/usr/bin/env sh

echo "ğŸ” Running Larastan static analysis..."

# Dockerã‚³ãƒ³ãƒ†ãƒŠãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèª
if ! docker-compose ps app 2>/dev/null | grep -q "Up"; then
    echo "âš ï¸  Docker container 'app' is not running."
    echo "Please start the container with: make up"
    exit 1
fi

# Larastanå®Ÿè¡Œï¼ˆ-T ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§éå¯¾è©±ãƒ¢ãƒ¼ãƒ‰ï¼‰
docker-compose exec -T app ./vendor/bin/phpstan analyse --memory-limit=1G

# çµ‚äº†ã‚³ãƒ¼ãƒ‰ã‚’ä¿å­˜
EXIT_CODE=$?

if [ $EXIT_CODE -ne 0 ]; then
    echo "âŒ Larastan found errors. Please fix them before committing."
    exit 1
fi

echo "âœ… Larastan check passed!"
exit 0
